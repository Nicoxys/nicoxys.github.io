(self.webpackChunkpages=self.webpackChunkpages||[]).push([[712],{9829:(X,R,t)=>{"use strict";t.d(R,{R:()=>_});class _{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U]),this.validateOptions()}setOptionsFromChanges(e){Object.keys(e).filter(U=>U in this).forEach(U=>this[U]=e[U].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}},9582:(X,R,t)=>{"use strict";t.d(R,{y:()=>o});var _=t(5861);var x=t(5879);let o=(()=>{class g{constructor(){this.autoRotateSupported=function e(){return new Promise(g=>{const f=new Image;f.onload=()=>{g(1===f.width&&2===f.height)},f.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(l,p){return new Promise((h,A)=>{const b=new FileReader;b.onload=S=>{this.loadImage(S.target.result,l.type,p).then(h).catch(A)},b.readAsDataURL(l)})}loadImage(l,p,h){return this.isValidImageType(p)?this.loadBase64Image(l,h):Promise.reject(new Error("Invalid image type"))}isValidImageType(l){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(l)}loadImageFromURL(l,p){return new Promise((h,A)=>{const b=new Image;b.onerror=()=>A,b.onload=()=>{const S=document.createElement("canvas"),K=S.getContext("2d");S.width=b.width,S.height=b.height,K?.drawImage(b,0,0),this.loadBase64Image(S.toDataURL(),p).then(h)},b.crossOrigin="anonymous",b.src=l})}loadBase64Image(l,p){return new Promise((h,A)=>{const b=new Image;b.onload=()=>h({originalImage:b,originalBase64:l}),b.onerror=A,b.src=l}).then(h=>this.transformImageBase64(h,p))}transformImageBase64(l,p){var h=this;return(0,_.Z)(function*(){const A=yield h.autoRotateSupported,b=yield function U(g){switch("string"==typeof g&&(g=function I(g){const f=new DataView(function s(g){g=g.replace(/^data\:([^\;]+)\;base64,/gim,"");const f=atob(g),l=f.length,p=new Uint8Array(l);for(let h=0;h<l;h++)p[h]=f.charCodeAt(h);return p.buffer}(g));if(65496!==f.getUint16(0,!1))return-2;const l=f.byteLength;let p=2;for(;p<l;){if(f.getUint16(p+2,!1)<=8)return-1;const h=f.getUint16(p,!1);if(p+=2,65505==h){if(1165519206!==f.getUint32(p+=2,!1))return-1;const A=18761==f.getUint16(p+=6,!1);p+=f.getUint32(p+4,A);const b=f.getUint16(p,A);p+=2;for(let S=0;S<b;S++)if(274==f.getUint16(p+12*S,A))return f.getUint16(p+12*S+8,A)}else{if(65280!=(65280&h))break;p+=f.getUint16(p,!1)}}return-1}(g)),g){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(A?-1:l.originalBase64);return l.originalImage&&l.originalImage.complete?h.transformLoadedImage({original:{base64:l.originalBase64,image:l.originalImage,size:{width:l.originalImage.naturalWidth,height:l.originalImage.naturalHeight}},exifTransform:b},p):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(l,p){var h=this;return(0,_.Z)(function*(){const A=p.canvasRotation+l.exifTransform.rotate,b={width:l.original.image.naturalWidth,height:l.original.image.naturalHeight};if(0===A&&!l.exifTransform.flip&&!p.containWithinAspectRatio)return{original:{base64:l.original.base64,image:l.original.image,size:{...b}},transformed:{base64:l.original.base64,image:l.original.image,size:{...b}},exifTransform:l.exifTransform};const S=h.getTransformedSize(b,l.exifTransform,p),K=document.createElement("canvas");K.width=S.width,K.height=S.height;const M=K.getContext("2d");M?.setTransform(l.exifTransform.flip?-1:1,0,0,1,K.width/2,K.height/2),M?.rotate(Math.PI*(A/2)),M?.drawImage(l.original.image,-b.width/2,-b.height/2);const O=K.toDataURL(),u=yield h.loadImageFromBase64(O);return{original:{base64:l.original.base64,image:l.original.image,size:{...b}},transformed:{base64:O,image:u,size:{width:u.width,height:u.height}},exifTransform:l.exifTransform}})()}loadImageFromBase64(l){return new Promise((p,h)=>{const A=new Image;A.onload=()=>p(A),A.onerror=h,A.src=l})}getTransformedSize(l,p,h){const A=h.canvasRotation+p.rotate;if(h.containWithinAspectRatio){if(A%2){const S=l.height/h.aspectRatio;return{width:Math.max(l.height,l.width*h.aspectRatio),height:Math.max(l.width,S)}}{const S=l.width/h.aspectRatio;return{width:Math.max(l.width,l.height*h.aspectRatio),height:Math.max(l.height,S)}}}return A%2?{height:l.width,width:l.height}:{width:l.width,height:l.height}}}return g.\u0275fac=function(l){return new(l||g)},g.\u0275prov=x.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},3705:(X,R,t)=>{"use strict";function _(P){const e=P.split(","),U=e[0].replace("data:","").replace(";base64",""),I=atob(e[1]),s=new ArrayBuffer(I.length),x=new Uint8Array(s);for(let o=0;o<I.length;o+=1)x[o]=I.charCodeAt(o);return new Blob([s],{type:U})}t.d(R,{L:()=>_})},5851:(X,R,t)=>{"use strict";t.d(R,{B:()=>V});var _=t(5861),P=t(1378),e=t(5879),U=t(2438),I=t(4036),s=t(9054),x=t(4020),o=t(148),g=t(9093),f=t(7621),l=t(1990),p=t(5661),h=t(5172),A=t(3845),b=t(4887),S=t(5487),K=t(3779),M=t(2800),O=t(6814),u=t(6223),E=t(4929),y=t(554),C=t(4464),D=t(4228);const B=["fileInput"];function $(a,F){1&a&&(e.O4$(),e.TgZ(0,"svg",31),e._UZ(1,"path",32)(2,"path",33),e.qZA())}const Q=function(){return["text-primary"]};function q(a,F){1&a&&e._UZ(0,"app-logo",34),2&a&&e.Q6J("svgClass",e.DdM(2,Q))("responsive",!1)}function oe(a,F){1&a&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&a&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.DESKTOP"),e.oJD)}function ie(a,F){1&a&&(e._UZ(0,"span",38),e.ALo(1,"translate")),2&a&&e.Q6J("innerHTML",e.lcZ(1,1,"COMPONENTS.UPLOADER.DESCRIPTION.TOUCH"),e.oJD)}const ae=function(a){return{"fw-bold fs-md-lg":a}},pe=function(a){return{"text-decoration-underline":a}};function le(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"div",35),e.YNc(1,oe,2,3,"span",36),e.YNc(2,ie,2,3,"span",36),e.TgZ(3,"span",37),e.NdJ("click",function(i){e.CHM(n);const w=e.oxw(2),N=e.MAs(23);return e.KtG(w.toggleRemoteUrlForm(i,N))}),e._uU(4),e.ALo(5,"translate"),e.qZA()()}if(2&a){const n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,ae,!n.isWidget)),e.xp6(1),e.Q6J("ngIf",!n.touchDevice),e.xp6(1),e.Q6J("ngIf",n.touchDevice),e.xp6(1),e.Q6J("ngClass",e.VKq(9,pe,n.isWidget)),e.xp6(1),e.Oqu(e.lcZ(5,5,"COMPONENTS.UPLOADER.DESCRIPTION.REMOTE_URL"))}}function _e(a,F){1&a&&e.GkF(0)}function ve(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"div",39),e.YNc(1,_e,1,0,"ng-container",17),e.TgZ(2,"button",40),e.NdJ("click",function(i){e.CHM(n);const w=e.oxw(2);return e.KtG(w.handleRemoteUrlUpload(i))}),e.O4$(),e.TgZ(3,"svg",41),e._UZ(4,"path",42),e.qZA()(),e.kcU(),e.TgZ(5,"button",43),e.NdJ("click",function(i){e.CHM(n);const w=e.oxw(2);return e.KtG(w.toggleRemoteUrlForm(i))}),e.O4$(),e.TgZ(6,"svg",41),e._UZ(7,"path",44),e.qZA()()()}if(2&a){const n=e.oxw(2),m=e.MAs(34);e.xp6(1),e.Q6J("ngTemplateOutlet",m),e.xp6(1),e.Q6J("disabled",0===n.remoteUrl.length||!n.isRemoteUrlValid)}}function Ee(a,F){if(1&a&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"em",45),e.ALo(5,"arrayJoin"),e.BQk()),2&a){const n=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"COMPONENTS.UPLOADER.PATH.LONG")," "),e.xp6(2),e.Q6J("innerText",n.currentFolderPath.length?e.xi3(5,4,n.currentFolderPath,"/"):"root")}}function v(a,F){if(1&a&&(e._UZ(0,"div",50),e.ALo(1,"arrayJoin"),e.ALo(2,"slice")),2&a){const n=e.oxw(3);e.Q6J("innerText",e.xi3(1,1,e.Dn7(2,4,n.currentFolderPath,0,-1),"/"))}}function r(a,F){if(1&a&&(e.TgZ(0,"div",46)(1,"div",47),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,v,3,8,"div",48),e._UZ(5,"div",49),e.ALo(6,"arrayJoin"),e.ALo(7,"slice"),e.qZA()),2&a){const n=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,"COMPONENTS.UPLOADER.PATH.SHORT")),e.xp6(2),e.Q6J("ngIf",n.currentFolderPath.length>1),e.xp6(1),e.Q6J("innerText",(n.currentFolderPath.length>1?"/":"")+(n.currentFolderPath.length?e.xi3(6,5,e.xi3(7,8,n.currentFolderPath,n.currentFolderPath.length-1),"/"):"root"))}}const c=function(){return{bottom:0,left:0}};function d(a,F){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"a",51),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.openInfoModal.emit())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",52),e.NdJ("click",function(){e.CHM(n),e.oxw(2);const i=e.MAs(7);return e.KtG(i.open())}),e._uU(5,"settings"),e.qZA(),e.TgZ(6,"div",53),e.NdJ("click",function(i){e.CHM(n);const w=e.oxw(2),N=e.MAs(23);return e.KtG(w.toggleRemoteUrlForm(i,N))}),e._uU(7,"add_link"),e.qZA(),e.BQk()}2&a&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(4,c)),e.xp6(1),e.Oqu(e.lcZ(3,2,"COMPONENTS.UPLOADER.INFO")))}const T=function(a,F,n){return{"cursor-pointer":a,"py-4 px-3 px-sm-4":F,"p-2 pb-3":n}},L=function(a,F,n){return{"my-2":a,"mb-2":F,"mw-100 mt-1":n}};function H(a,F){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",22,23),e.NdJ("dragenter",function(){e.CHM(n);const i=e.MAs(2),w=e.oxw();return e.KtG(w.setDragOverEvent(i))})("drop",function(i){e.CHM(n);const w=e.oxw();return e.KtG(w.handleDropEvent(i))})("click",function(){e.CHM(n);const i=e.oxw(),w=e.MAs(2);return e.KtG(!i.isWaitingRemoteUrl&&w.click())}),e.YNc(3,$,3,0,"svg",24),e.YNc(4,q,1,3,"ng-template",null,25,e.W1O),e.YNc(6,le,6,11,"div",26),e.YNc(7,ve,8,2,"div",27),e.TgZ(8,"div",28),e.YNc(9,Ee,6,7,"ng-container",3),e.YNc(10,r,8,11,"ng-template",null,29,e.W1O),e.qZA()(),e.YNc(12,d,8,5,"ng-container",30),e.BQk()}if(2&a){const n=e.MAs(5),m=e.MAs(11),i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.kEZ(9,T,!i.loading&&!i.isWaitingRemoteUrl,!i.isWidget,i.isWidget)),e.xp6(2),e.Q6J("ngIf",!i.isWidget)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!i.isWidget||!i.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngIf",i.isWidget&&i.isWaitingRemoteUrl),e.xp6(1),e.Q6J("ngClass",e.kEZ(13,L,!i.isWidget&&!i.touchDevice,!i.isWidget&&i.touchDevice,i.isWidget)),e.xp6(1),e.Q6J("ngIf",!i.isWidget)("ngIfElse",m),e.xp6(3),e.Q6J("ngIf",!i.isWidget)}}const Z=function(a,F){return{"p-4":a,"p-2":F}};function W(a,F){if(1&a&&(e.TgZ(0,"div",54),e.O4$(),e.TgZ(1,"svg",55),e._UZ(2,"path",56),e.qZA(),e.kcU(),e._UZ(3,"app-loader",57),e.TgZ(4,"div",58),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&a){const n=e.oxw();e.Q6J("ngClass",e.WLB(6,Z,!n.isWidget,n.isWidget)),e.xp6(3),e.Q6J("onlyMessage",!0)("message",n.loadingMessage),e.xp6(2),e.Oqu(e.lcZ(6,4,"COMPONENTS.UPLOADER.LOADING.SUBTEXT"))}}function j(a,F){1&a&&e.GkF(0)}const k=function(a){return{"fs-reset":a}};function G(a,F){if(1&a){const n=e.EpF();e.TgZ(0,"input",59,60),e.NdJ("ngModelChange",function(i){e.CHM(n);const w=e.oxw();return e.KtG(w.remoteUrl=i)})("ngModelChange",function(){e.CHM(n);const i=e.MAs(1),w=e.oxw();return e.KtG(w.isRemoteUrlValid=!i.invalid)}),e.ALo(2,"translate"),e.qZA()}if(2&a){const n=e.oxw();e.Q6J("placeholder",e.lcZ(2,4,"COMPONENTS.UPLOADER.REMOTE_URL_INPUT_PLACEHOLDER"))("ngClass",e.VKq(6,k,n.isWidget))("ngModel",n.remoteUrl)("pattern","^https?://[^.]+\\.(.+)")}}const te=function(a,F){return{uploading:a,"widget flex-grow-1 min-w-0":F}};let V=(()=>{class a{constructor(n,m,i,w,N,J,ne,se,ee){this.postMessageService=n,this.uploadService=m,this.uploadObservablesService=i,this.uploaderService=w,this.toastService=N,this.renderer=J,this.ngZone=ne,this.translateService=se,this.proxyService=ee,this.loading=!0,this.currentFolderPath=[],this.isWidget=!1,this.fileUploadedEvent=new e.vpe,this.openInfoModal=new e.vpe,this.isUploading=!1,this.loadingMessage="",this.touchDevice=x.eX,this.isWaitingRemoteUrl=!1,this.remoteUrl="",this.isRemoteUrlValid=!1,this.dragOverEvent=!1,this.checkingFileMessage="",this.options=this.uploaderService.uploaderOptions;const Y=this.uploadService.preferences.uploader;Y.checkImage.active||(this.options.compress=!1),Y.showLinkModal&&(this.options.openLinkModalAfterUpload=!0),this.uploaderService.uploaderOptions=this.options}ngOnInit(){var n=this;return(0,_.Z)(function*(){n.handleClipboardPasteEvent(),n.handleExternalUpload(),n.checkingFileMessage=n.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CHECK"),n.loadingMessage=n.checkingFileMessage})()}handleClipboardPasteEvent(){var n=this;this.clipboardPasteEventSubscription=(0,U.R)(document.body,"paste").subscribe(function(){var m=(0,_.Z)(function*(i){if(n.isWidget&&n.isWaitingRemoteUrl||!n.canUpload())return;const w=Array.from((i.clipboardData||i.originalEvent.clipboardData).items);let N=[];for(const J of w)if(0===J.type.indexOf("image")){const ne=J.getAsFile();ne&&N.push(ne)}N.length>0?yield n.preUpload(N):n.reset()});return function(i){return m.apply(this,arguments)}}())}handleExternalUpload(){var n=this;this.startExternalUploadSubscription=this.uploadObservablesService.startUploadObservable.subscribe(function(){var m=(0,_.Z)(function*(i){if(i){if(!n.canUpload())return;yield n.preUpload([i.file],i.options)}else n.fileInputRef.nativeElement.click()});return function(i){return m.apply(this,arguments)}}())}handleSelectionEvent(n){var m=this;return(0,_.Z)(function*(){if(!m.canUpload())return;const i=n.target;if(i.files&&i.files.length){const w=Array.from(i.files);return i.value="",m.preUpload(w)}m.reset()})()}handleDropEvent(n){var m=this;return(0,_.Z)(function*(){if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!m.canUpload())return;const i=n.dataTransfer?.files?Array.from(n.dataTransfer.files):[];if(i.length)return m.preUpload(i);m.reset()})()}handleRemoteUrlUpload(n,m){var i=this;return(0,_.Z)(function*(){if(!i.isRemoteUrlValid||0===i.remoteUrl.length||!i.canUpload())return;const w=i.remoteUrl;i.loadingMessage=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.GETTING_REMOTE_FILE"),i.toggleRemoteUrlForm(n,m);const N=(0,s.Tb)(w);if(!N.ext||-1===l.O8.findIndex(ne=>-1!==ne.ext.indexOf(N.ext)))return i.handleErrors([N.name],[]),void i.reset();const J=yield i.proxyService.get(w);return J?i.preUpload([new File([J],N.name,{type:J.type,lastModified:Date.now()})]):(i.toastService.show({content:"Errore nel recupero dell'immagine dall'url!",level:P.m.ERROR}),i.reset(),void i.postMessageService.send(o.l.UPLOAD_ERROR,{filename:N.name,error:A.S.REMOTE_URL_RESPONSE}))})()}saveOptions(n=!0){this.uploaderService.uploaderOptions=this.options,n&&this.savePreferences()}savePreferences(){this.uploadService.preferences.uploader={checkImage:{active:this.options.compress,time:Date.now()},showLinkModal:this.options.openLinkModalAfterUpload}}setDragOverEvent(n){this.dragOverEvent||(this.dragOverEvent=!0,this.ngZone.runOutsideAngular(()=>{this.renderer.listen(n,"dragover",m=>{m.preventDefault()})}))}canUpload(){return!this.loading&&!this.isUploading&&(this.isUploading=!0,this.dragOverEvent=!1,!0)}reset(){this.isUploading=!1,this.loadingMessage=this.checkingFileMessage,this.postMessageService.send(o.l.UPLOAD_END,{}),this.options.allowOverwrite=!1,this.saveOptions(!1)}preUpload(n,m){var i=this;return(0,_.Z)(function*(){const w=[...i.currentFolderPath];let N=[],J=[],ne=[],se=[];m?m.allowOverwrite=m.allowOverwrite||!1:(m=i.uploaderService.uploaderOptions).allowOverwrite=!1;for(let z=0;z<n.length;z++){let re=m.compress?yield i.uploaderService.compressFileIfNeeded(n[z],m.imageDimensions):n[z];if(re=yield i.uploaderService.orientFileIfNeeded(re),re){const ue=(0,s.Tb)(re.name),he=l.O8.find(me=>-1!==me.ext.indexOf(ue.ext));if(!he){ne.push(re.name);continue}if(re.size>he.maxSize){se.push(re.name);continue}N.push({file:{name:re.name,size:re.size,time:0,url:"",ext:ue.ext,filename:ue.filename,isImage:(0,s.Or)(ue.ext),embedUrl:"",type:h.VC.FILE},progress:0,completed:!1}),J.push(re)}}if(i.handleErrors(ne,se),0===J.length)return void i.reset();const ee=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.UPLOADING",{total:J.length}),Y=i.translateService.instant("COMPONENTS.UPLOADER.LOADING.MESSAGE.CREATING_PACKAGE",{total:J.length});i.uploadObservablesService.pushUploadingFileQueue(N);for(let z=0;z<J.length;++z){i.loadingMessage=Y;const re=yield i.uploadService.getHostToken(w,J[z].name);N[z].progress+=20,i.loadingMessage=ee.replace("{{current}}",`${z+1}`),yield(0,I.z)(i.uploaderService.upload(J[z],N[z],re,m.allowOverwrite))}i.uploadObservablesService.pushUploadingFileQueue([]);const ce=N.filter(z=>!z.error).map(z=>z.file);ce.length>0&&(i.fileUploadedEvent.emit({list:ce,rewrite:m.allowOverwrite,destPath:w}),i.postMessageService.send(o.l.UPLOAD_SUCCESS,{fileList:ce.map(z=>({filename:z.name,isImage:z.isImage,url:z.url}))}),m.openLinkModalAfterUpload&&i.uploadObservablesService.pushAction({name:h.In.FILE_SHOW_LINKS,payload:{entities:(0,s.jL)(ce)}})),i.reset()})()}handleErrors(n,m){if(0!==n.length||0!==m.length){if(!this.isWidget)return void this.toastService.show({content:this.createToastMessage(n,m),level:P.m.ERROR});[[A.S.UNSUPPORTED,n],[A.S.OVERSIZED,m]].forEach(i=>{i[1].forEach(w=>{this.postMessageService.send(o.l.UPLOAD_ERROR,{filename:w,error:i[0]})})})}}createToastMessage(n,m){let i=[];return n.length&&i.push(n.length>1?`I file <strong>${n.join(", ")}</strong> hanno un formato non supportato!`:`Il file <strong>${n[0]}</strong> ha un formato non supportato!`),m.length&&i.push(m.length>1?`I file <strong>${m.join(", ")}</strong> sono troppo pesanti!`:`Il file <strong>${m[0]}</strong> \xe8 troppo pesante!`),i.join("<br><br>")}toggleRemoteUrlForm(n,m){n.stopPropagation(),this.isWidget||(this.isWaitingRemoteUrl?m?.close():m?.open()),this.resetRemoteUrlForm(!this.isWaitingRemoteUrl)}resetRemoteUrlForm(n){this.isWaitingRemoteUrl=n,this.remoteUrl=""}ngOnDestroy(){this.startExternalUploadSubscription?.unsubscribe(),this.clipboardPasteEventSubscription.unsubscribe(),this.uploaderService.clearPendingRequests()}}return a.\u0275fac=function(n){return new(n||a)(e.Y36(g.F),e.Y36(K.C),e.Y36(S.r),e.Y36(b.q),e.Y36(p.k),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(M.sK),e.Y36(f.y))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-uploader"]],viewQuery:function(n,m){if(1&n&&e.Gf(B,5),2&n){let i;e.iGM(i=e.CRH())&&(m.fileInputRef=i.first)}},inputs:{loading:"loading",currentFolderPath:"currentFolderPath",isWidget:"isWidget"},outputs:{fileUploadedEvent:"fileUploadedEvent",openInfoModal:"openInfoModal"},decls:35,vars:37,consts:[[1,"uploader","rounded","position-relative",3,"ngClass"],["type","file",1,"d-none",3,"multiple","disabled","change"],["fileInput",""],[4,"ngIf","ngIfElse"],["uploading",""],[3,"title"],["optionsModal",""],[3,"innerHtml"],[1,"mb-1","list-unstyled"],[1,"form-check","form-switch"],["type","checkbox","role","switch","id","speed-upload",1,"form-check-input",3,"ngModel","ngModelChange"],["for","speed-upload",1,"form-check-label","me-auto",3,"innerHTML"],["type","checkbox","role","switch","id","show-link-modal",1,"form-check-input",3,"ngModel","ngModelChange"],["for","show-link-modal",1,"form-check-label","me-auto",3,"innerHTML"],["size","md",3,"title","disableCloseButton","hidden"],["remoteUrlModal",""],[1,"mb-2",3,"innerHTML"],[4,"ngTemplateOutlet"],["footer",""],["type","button",1,"btn","btn-secondary",3,"innerText","click"],["type","button",1,"btn","btn-primary",3,"disabled","innerText","click"],["remoteUrlInput",""],[1,"rounded","upload-area",3,"ngClass","dragenter","drop","click"],["uploadArea",""],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16",4,"ngIf","ngIfElse"],["appLogo",""],["class","description text-center",3,"ngClass",4,"ngIf"],["class","input-group input-group-sm remote-url-form justify-content-center mb-1",4,"ngIf"],[1,"small","text-center",3,"ngClass"],["widgetFolder",""],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","fill","currentColor","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],["svgSize","xl","subtext","Upload",1,"d-block","my-auto","py-1",3,"svgClass","responsive"],[1,"description","text-center",3,"ngClass"],[3,"innerHTML",4,"ngIf"],[1,"ms-1","remote-url-btn","fst-italic","cursor-pointer",3,"ngClass","click"],[3,"innerHTML"],[1,"input-group","input-group-sm","remote-url-form","justify-content-center","mb-1"],[1,"input-group-text","bg-light",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 16 16"],["d","M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"],[1,"input-group-text","bg-light",3,"click"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],[1,"text-break",3,"innerText"],[1,"d-flex","min-w-0"],[1,"me-1"],["class","fst-italic text-truncate mw-100",3,"innerText",4,"ngIf"],[1,"fst-italic","text-nowrap",3,"innerText"],[1,"fst-italic","text-truncate","mw-100",3,"innerText"],[1,"fs-xs","fst-italic","d-block","px-2","py-1","text-reset","cursor-pointer","position-absolute",3,"ngStyle","click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","options-icon",3,"click"],[1,"material-icons-outlined","d-block","cursor-pointer","fs-xl","position-absolute","icon","remote-url-icon",3,"click"],[1,"p-4","rounded",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","64","height","64","viewBox","0 0 16 16",1,"overflow-visible"],["d","M 4.406 3.342 A 5.53 5.53 0 0 1 8 2 c 2.69 0 4.923 2 5.166 4.579 C 14.758 6.804 16 8.137 16 9.773 C 16 11.569 14.502 13 12.687 13 H 3.781 C 1.708 13 0 11.366 0 9.318 c 0 -1.763 1.266 -3.223 2.942 -3.593 c 0.143 -0.863 0.698 -1.723 1.464 -2.383 z",1,"cloud"],[3,"onlyMessage","message"],[1,"small","text-center"],["type","text","required","",1,"form-control",3,"placeholder","ngClass","ngModel","pattern","ngModelChange"],["input","ngModel"]],template:function(n,m){if(1&n){const i=e.EpF();e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("change",function(N){return m.handleSelectionEvent(N)}),e.qZA(),e.YNc(3,H,13,17,"ng-container",3),e.YNc(4,W,7,9,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"app-modal",5,6),e.ALo(8,"translate"),e._UZ(9,"div",7),e.ALo(10,"translate"),e.TgZ(11,"ul",8)(12,"li")(13,"div",9)(14,"input",10),e.NdJ("ngModelChange",function(N){return m.options.compress=N})("ngModelChange",function(){return m.saveOptions()}),e.qZA(),e._UZ(15,"label",11),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li")(18,"div",9)(19,"input",12),e.NdJ("ngModelChange",function(N){return m.options.openLinkModalAfterUpload=N})("ngModelChange",function(){return m.saveOptions()}),e.qZA(),e._UZ(20,"label",13),e.ALo(21,"translate"),e.qZA()()()(),e.TgZ(22,"app-modal",14,15),e.NdJ("hidden",function(){return m.resetRemoteUrlForm(!1)}),e.ALo(24,"translate"),e._UZ(25,"p",16),e.ALo(26,"translate"),e.YNc(27,j,1,0,"ng-container",17),e.ynx(28,18),e.TgZ(29,"button",19),e.NdJ("click",function(){e.CHM(i);const N=e.MAs(23);return e.KtG(N.close())}),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"button",20),e.NdJ("click",function(N){e.CHM(i);const J=e.MAs(23);return e.KtG(m.handleRemoteUrlUpload(N,J))}),e.ALo(32,"translate"),e.qZA(),e.BQk(),e.qZA(),e.YNc(33,G,3,8,"ng-template",null,21,e.W1O)}if(2&n){const i=e.MAs(5),w=e.MAs(34);e.Q6J("ngClass",e.WLB(34,te,m.isUploading,m.isWidget)),e.xp6(1),e.Q6J("multiple",!0)("disabled",m.loading||m.isUploading),e.xp6(2),e.Q6J("ngIf",!m.isUploading)("ngIfElse",i),e.xp6(3),e.Q6J("title",e.lcZ(8,18,"COMPONENTS.UPLOADER.SETTINGS_MODAL.TITLE")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(10,20,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.DESCRIPTION"),e.oJD),e.xp6(5),e.Q6J("ngModel",m.options.compress),e.xp6(1),e.Q6J("innerHTML",e.lcZ(16,22,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.COMPRESS_SWITCH"),e.oJD),e.xp6(4),e.Q6J("ngModel",m.options.openLinkModalAfterUpload),e.xp6(1),e.Q6J("innerHTML",e.lcZ(21,24,"COMPONENTS.UPLOADER.SETTINGS_MODAL.CONTENT.SHOW_LINK_SWITCH"),e.oJD),e.xp6(2),e.Q6J("title",e.lcZ(24,26,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.TITLE"))("disableCloseButton",!0),e.xp6(3),e.Q6J("innerHTML",e.lcZ(26,28,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.CONTENT"),e.oJD),e.xp6(2),e.Q6J("ngTemplateOutlet",w),e.xp6(2),e.Q6J("innerText",e.lcZ(30,30,"SHARED.CANCEL")),e.xp6(2),e.Q6J("disabled",0===m.remoteUrl.length||!m.isRemoteUrlValid)("innerText",e.lcZ(32,32,"COMPONENTS.UPLOADER.REMOTE_URL_MODAL.UPLOAD_BTN"))}},dependencies:[O.mk,O.O5,O.tP,O.PC,u.Fj,u.Wl,u.JJ,u.Q7,u.c5,u.On,E.R,y.R,C.z,D.J,O.OU,M.X$],styles:[".uploader[_ngcontent-%COMP%]:not(.widget){margin:0 1rem;border:2px dashed #4864FE;box-shadow:0 .125rem .25rem #00000013;color:#2036ad;height:100%}.uploader[_ngcontent-%COMP%]:not(.widget):not(.uploading)   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bubble 4s linear infinite}.uploader[_ngcontent-%COMP%]:not(.widget).uploading   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#2036ad}.uploader[_ngcontent-%COMP%]:not(.widget)   .description[_ngcontent-%COMP%]{max-width:350px}.uploader.widget.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{stroke:#4864fe}.uploader[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.icon){height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.uploader.uploading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path.cloud[_ngcontent-%COMP%]{fill:none;stroke-linecap:round;stroke-dasharray:50;stroke-dashoffset:100;animation:_ngcontent-%COMP%_draw 3.5s linear infinite}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{top:5px;opacity:.7;transition:opacity .2s}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1}.uploader[_ngcontent-%COMP%]   .options-icon[_ngcontent-%COMP%]{right:5px}.uploader[_ngcontent-%COMP%]   .remote-url-icon[_ngcontent-%COMP%]{right:30px}.upload-area.cursor-pointer[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(app-logo):not(.description), .upload-area.cursor-pointer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.remote-url-btn){pointer-events:none}.remote-url-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:300px}.remote-url-form[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}@media (min-width: 768px){.uploader[_ngcontent-%COMP%]:not(.widget){margin:initial}}@keyframes _ngcontent-%COMP%_bubble{6%{transform:scale(1.3,.8)}9%{transform:scale(.8,1.3) translateY(-.5rem)}12%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_draw{0%{stroke-dashoffset:100}to{stroke-dashoffset:0}}"]}),a})()},529:(X,R,t)=>{"use strict";t.d(R,{M:()=>g});var _=t(4243),P=t(6814),e=t(6223),U=t(7535),I=t(2740),s=t(4610),x=t(2800),o=t(5879);let g=(()=>{class f{}return f.\u0275fac=function(p){return new(p||f)},f.\u0275mod=o.oAB({type:f}),f.\u0275inj=o.cJS({imports:[_.r,P.ez,e.u5,U.q,I.h,s.z,x.aw.forChild()]}),f})()},3845:(X,R,t)=>{"use strict";t.d(R,{S:()=>_});var _=function(P){return P.UNSUPPORTED="unsupported",P.OVERSIZED="oversized",P.REMOTE_URL_RESPONSE="remote-url-response",P.UPLOAD_FAILED="upload-failed",P}(_||{})},4243:(X,R,t)=>{"use strict";t.d(R,{r:()=>e});var _=t(6814),P=t(5879);let e=(()=>{class U{}return U.\u0275fac=function(s){return new(s||U)},U.\u0275mod=P.oAB({type:U}),U.\u0275inj=P.cJS({imports:[_.ez]}),U})()},4228:(X,R,t)=>{"use strict";t.d(R,{J:()=>P});var _=t(5879);let P=(()=>{class e{transform(I,s){return I.join(s)}}return e.\u0275fac=function(I){return new(I||e)},e.\u0275pipe=_.Yjl({name:"arrayJoin",type:e,pure:!0}),e})()},5172:(X,R,t)=>{"use strict";t.d(R,{In:()=>_,Ky:()=>I,VC:()=>P,c5:()=>U,gG:()=>e});var _=function(s){return s.FILE_SHOW_LINKS="fileLinks",s.FILE_EDIT="fileEdit",s.DELETE="delete",s.RENAME="rename",s.MOVE="move",s}(_||{}),P=function(s){return s.FILE="file",s.FOLDER="folder",s}(P||{}),e=function(s){return s.FILENAME="filename",s.SIZE="size",s.TIME="time",s.EXTENSION="ext",s}(e||{}),U=function(s){return s.GRID="grid",s.LIST="list",s}(U||{}),I=function(s){return s.W_768_I_1="(max-width: 767.98px)",s.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",s.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",s.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",s.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",s.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",s.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",s.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",s.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",s.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",s.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",s.W_3738_I_10="(min-width: 3424px)",s}(I||{})},1990:(X,R,t)=>{"use strict";t.d(R,{C7:()=>U,Mi:()=>I,O8:()=>P,er:()=>s,p0:()=>e,xt:()=>x});var _=t(5172);const P=[{ext:["png","apng"],maxSize:15},{ext:["jpeg","jpg","jpe"],maxSize:10},{ext:["gif"],maxSize:15},{ext:["bmp"],maxSize:10},{ext:["webp","webm"],maxSize:10},{ext:["psd","xcf"],maxSize:150},{ext:["svg"],maxSize:30}].map(o=>(o.maxSize*=1048576,o)),e={lastPath:[],layout:{asc:!0,orderBy:_.gG.FILENAME,type:_.c5.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},U="https://upload.forumfree.net/api/",I=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,s=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,x={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1}},7621:(X,R,t)=>{"use strict";t.d(R,{y:()=>h});var _=t(5861),P=t(1345),e=t(4725),U=t(622),I=t(708),s=t(8180),x=t(4664),o=t(2096),g=t(6306),f=t(5083),l=t(5879),p=t(9862);let h=(()=>{class A{constructor(S,K){this.http=S,this.endpointsService=K}get(S){var K=this;return(0,_.Z)(function*(){const M=K.sendRequest(S);return yield(0,I.n)(M)})()}sendRequest(S){return this.getUrlContent(S).pipe((0,s.q)(1),(0,x.w)(K=>(0,o.of)(K)),(0,g.K)(()=>this.getUrlContentWithProxy(S)))}getUrlContent(S){return this.http.get(S,{responseType:"blob"})}getUrlContentWithProxy(S){return this.http.get(this.endpointsService.get(P.jQ.PROXY,P.ph.COMMON),{headers:{[U._.HeaderKeys.TOKEN_TYPE]:f.s.ACCESS,"x-remote-url":S},responseType:"blob"}).pipe((0,s.q)(1),(0,g.K)(()=>(0,o.of)(void 0)))}}return A.\u0275fac=function(S){return new(S||A)(l.LFG(p.eN),l.LFG(e.o))},A.\u0275prov=l.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},5983:(X,R,t)=>{"use strict";t.d(R,{B:()=>U});var _=t(5172),P=t(1410),e=t(5879);let U=(()=>{class I{constructor(x){this.globalsService=x,this.ffuid="",this.cache={},this.profileSubscription=this.globalsService.profileObservable.subscribe(o=>{this.ffuid=o?o.user.ffuid:""})}getItem(x){const o=this.createKey(x);if(this.cache.hasOwnProperty(o))return this.cache[o]}setItem(x,o){this.cache[this.createKey(x)]=o}removeItem(x){const o=this.createKey(x);if(this.cache.hasOwnProperty(o)){if(this.cache[o].folders.length)for(const g of this.cache[o].folders)this.removeItem([...x,g.name]);return delete this.cache[o],!0}return!1}getEntities(x,o){let g={};const f=this.createKey(x);if(!this.cache.hasOwnProperty(f))return g;for(const l of o){const p=(l.type===_.VC.FILE?this.cache[f].files:this.cache[f].folders).find(h=>h.name===l.name);p&&(g[p.name]=p)}return g}addEntities(x,o,g=_.VC.FILE){const f=this.createKey(x);return!!this.cache.hasOwnProperty(f)&&(Array.isArray(o)||(o=[o]),g===_.VC.FILE?this.cache[f].files.unshift(...o):this.cache[f].folders.unshift(...o),!0)}removeEntities(x,o,g=_.VC.FILE){if(Array.isArray(o)||(o=[o]),g===_.VC.FOLDER)for(const h of o)this.removeItem([...x,h]);const f=this.createKey(x);if(!this.cache.hasOwnProperty(f))return[];const l=g===_.VC.FILE?"files":"folders";let p=[];for(const h of o){const A=this.cache[f][l].findIndex(b=>b.name===h);A>-1&&(this.cache[f][l].splice(A,1),p.push(h))}return p}refactorFolderContent(x,o){const g=this.createKey(x);if(!this.cache.hasOwnProperty(g))return!1;o.endsWith("/")||(o+="/");for(const f of this.cache[g].folders)f.url=o+f.name;for(const f of this.cache[g].files)f.url=f.embedUrl=o+f.name,f.time=Date.now();return!0}createKey(x){return`${this.ffuid}/${x.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}}return I.\u0275fac=function(x){return new(x||I)(e.LFG(P.d))},I.\u0275prov=e.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})()},5487:(X,R,t)=>{"use strict";t.d(R,{r:()=>I});var _=t(8645),P=t(5619),e=t(446),U=t(5879);let I=(()=>{class s{constructor(o){this.uploadPreferencesService=o,this.selectedFileListArray=[],this.actionSubject=new _.x,this.uploadingFileQueueSubject=new _.x,this.uploadingFileErrorSubject=new _.x,this.currentFolderPathSubject=new _.x,this.layoutOptionsSubject=new _.x,this.renameEntitySubject=new _.x,this.entityPendingSubject=new _.x,this.deleteFileSubject=new _.x,this.uploadedFileSubject=new _.x,this.draggedFileListSubject=new _.x,this.startUploadSubject=new _.x,this.startMoveSubject=new _.x,this.selectedFileListSubject=new P.X(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(o){this.actionSubject.next(o)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(o){this.uploadPreferencesService.layoutOptions=o,this.layoutOptionsSubject.next(o)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(o){this.uploadPreferencesService.lastFolderPath=o,this.currentFolderPathSubject.next(o)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(o){this.uploadingFileQueueSubject.next(o)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(o){this.uploadingFileErrorSubject.next(o)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(o){this.renameEntitySubject.next(o)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(o){this.entityPendingSubject.next(o)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(o){this.deleteFileSubject.next(o)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(o){this.uploadedFileSubject.next(o)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(o){this.draggedFileListSubject.next(o)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(o){this.startUploadSubject.next(o)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(o){this.startMoveSubject.next(o)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(o){if(Array.isArray(o)||(o=[o]),0===o.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let g=!1;for(const f of o){const l=this.selectedFileListArray.findIndex(p=>p.name===f.name);f.selected?-1===l&&(this.selectedFileListArray.push({name:f.name}),g=!0):l>-1&&(this.selectedFileListArray.splice(l,1),g=!0)}g&&this.selectedFileListSubject.next(this.selectedFileListArray)}}return s.\u0275fac=function(o){return new(o||s)(U.LFG(e.p))},s.\u0275prov=U.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},446:(X,R,t)=>{"use strict";t.d(R,{p:()=>s});var _=t(7165),P=t(463),e=t(1990),U=t(2986),I=t(5879);let s=(()=>{class x{constructor(g,f){this.preferencesService=g,this.urlQueryParamsService=f;const l=this.urlQueryParamsService.getAndDeleteParam(_.RT.UPLOAD_PATH);l&&(this.lastFolderPath=l.split("/").filter(p=>p.length>0))}get preferences(){return this.preferencesService.getItem(_.Ye.UPLOAD)||e.p0}set preferences(g){this.preferencesService.setItem(_.Ye.UPLOAD,g)}get lastFolderPath(){return(this.preferences.lastPath||e.p0.lastPath).filter(g=>g.length>0)}set lastFolderPath(g){const f=this.preferences;f.lastPath=g,this.preferences=f}get layoutOptions(){const g=e.p0.layout,f=this.preferences.layout;return f&&0===Object.keys(g).filter(l=>!f.hasOwnProperty(l)).length?f:g}set layoutOptions(g){const f=this.preferences;f.layout=g,this.preferences=f}get uploader(){const g=this.preferences.uploader||e.p0.uploader;return!g.checkImage.active&&Date.now()-g.checkImage.time>6048e5&&(g.checkImage.active=!0,this.uploader=g),g.hasOwnProperty("showLinkModal")||(g.showLinkModal=!1),g}set uploader(g){const f=this.preferences;f.uploader=g,this.preferences=f}}return x.\u0275fac=function(g){return new(g||x)(I.LFG(P.y),I.LFG(U.J))},x.\u0275prov=I.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},3779:(X,R,t)=>{"use strict";t.d(R,{C:()=>O});var _=t(5861),P=t(6347),e=t(622),U=t(4036),I=t(5172),s=t(9054),h=t(5983),A=t(1990),b=t(446),S=t(4004),K=t(5879),M=t(9862);let O=(()=>{class u{constructor(y,C,D,B){this.graphqlService=y,this.uploadCacheService=C,this.uploadPreferencesService=D,this.http=B}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(e._.HeaderKeys.UUID,(0,S.Z)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(e._.HeaderKeys.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(e._.HeaderKeys.UUID)||""}getFileList(y,C){var D=this;return(0,_.Z)(function*(){const B=D.uploadCacheService.getItem(y);if(B)return B;const $=(yield D.graphqlService.query({query:"\nquery UploadEntitiesListToken($scope: String, $target: String!) {\n    uploadEntitiesListToken(scope: $scope, target: $target)\n}",variables:{scope:C,target:y.join("/")}})).data.uploadEntitiesListToken,Q=yield D.sendRequest($),oe={files:Q.files.map(ie=>{const ae=(0,s.Tb)(ie.url);return{...ie,time:1e3*ie.time,filename:ae.filename,ext:ae.ext,isImage:(0,s.Or)(ae.ext),embedUrl:`${ie.url}?t=${ie.time}`,type:I.VC.FILE}}),folders:Q.folders.map(ie=>({...ie,type:I.VC.FOLDER}))};return D.uploadCacheService.setItem(y,oe),oe})()}createDirectory(y,C){var D=this;return(0,_.Z)(function*(){const B=(yield D.graphqlService.mutate({mutation:"\nquery UploadEntitiesCreateDirectoryToken($scope: String, $target: String!) {\n    uploadEntitiesCreateDirectoryToken(scope: $scope, target: $target)\n}",variables:{scope:C,target:y.join("/")}})).data.uploadEntitiesCreateDirectoryToken;return yield D.sendRequest(B)})()}moveRenameEntity(y,C,D,B,$){var Q=this;return(0,_.Z)(function*(){B||(B=D);const q=(yield Q.graphqlService.mutate({mutation:"\nquery UploadEntitiesMoveToken($scope: String, $source: String!, $target: String!) {\n    uploadEntitiesMoveToken(scope: $scope, source: $source, target: $target)\n}",variables:{scope:$,source:(y.length?`${y.join("/")}/`:"")+D,target:(C.length?`${C.join("/")}/`:"")+B}})).data.uploadEntitiesMoveToken,oe=yield Q.sendRequest(q);return{...oe,time:1e3*oe.time}})()}deleteEntity(y,C,D){var B=this;return(0,_.Z)(function*(){const $=(yield B.graphqlService.mutate({mutation:"\nquery UploadEntitiesDeleteToken($scope: String, $target: String!) {\n    uploadEntitiesDeleteToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(y.length?`${y.join("/")}/`:"")+C}})).data.uploadEntitiesDeleteToken;return yield B.sendRequest($),!0})()}getHostToken(y,C,D){var B=this;return(0,_.Z)(function*(){return(yield B.graphqlService.query({query:"\nquery UploadEntitiesHostToken($scope: String, $target: String!) {\n    uploadEntitiesHostToken(scope: $scope, target: $target)\n}",variables:{scope:D,target:(y.length?`${y.join("/")}/`:"")+C}})).data.uploadEntitiesHostToken})()}sendRequest(y){var C=this;return(0,_.Z)(function*(){return(yield(0,U.z)(C.http.post(A.C7,JSON.stringify({payload:y}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(y,C){var D=this;return(0,_.Z)(function*(){return yield D.graphqlService.subscribe({query:"\nsubscription UploadEntities($scope: String) {\n    uploadEntities(scope: $scope) {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}",variables:{scope:C}},B=>{if(!B.data?.uploadEntities)return;const $=JSON.parse(B.data.uploadEntities.eventMessage);!$.payload.customHeaders||!$.payload.customHeaders.hasOwnProperty(e._.HeaderKeys.UUID)||$.payload.customHeaders[e._.HeaderKeys.UUID]===D.getGqlIdHeader()||y({type:B.data.uploadEntities.eventType,message:$})})})()}}return u.\u0275fac=function(y){return new(y||u)(K.LFG(P.J),K.LFG(h.B),K.LFG(b.p),K.LFG(M.eN))},u.\u0275prov=K.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},9054:(X,R,t)=>{"use strict";t.d(R,{$H:()=>A,JN:()=>f,Lv:()=>s,Or:()=>h,Tb:()=>U,jL:()=>p,lY:()=>x,ok:()=>S,rQ:()=>K,rc:()=>b,sT:()=>o,zO:()=>I});var _=t(5861),P=t(5172),e=t(1990);function U(M){let O=M;if(M.indexOf("/")>-1){const C=M.split("/");O=C[C.length-1]}const u=O.replace(/\?.*$/,"").split("."),E=u.length>1?u[u.length-1].toLowerCase():"",y=decodeURIComponent(u.slice(0,-1).join("."));return{ext:E,filename:y,name:E?`${y}.${E}`:""}}function I(M,O={}){const u=U(M),E=Date.now();return{name:u.name,size:0,time:E,url:M,ext:u.ext,filename:u.filename,isImage:h(u.ext),embedUrl:`${M}?t=${E}`,type:P.VC.FILE,...O}}function s(M){let O=M;O.endsWith("/")&&(O=O.slice(0,-1));const u=O.split("/");return{name:decodeURIComponent(u[u.length-1])}}function x(M){return{name:s(M).name,url:M,type:P.VC.FOLDER}}function o(M){return g.apply(this,arguments)}function g(){return(g=(0,_.Z)(function*(M){const O=new FileReader,u=new Promise(E=>O.addEventListener("load",()=>E(O.result)));return O.readAsDataURL(M),u})).apply(this,arguments)}function f(M){return l.apply(this,arguments)}function l(){return(l=(0,_.Z)(function*(M){const O=new DataView(yield M.arrayBuffer());if(2303741511===O.getUint32(0)&&218765834===O.getUint32(4)){if(-1===[4,6].indexOf(O.getUint8(25)))return!1;const E=Object.assign(new Image,{src:yield o(M)});yield new Promise(D=>E.addEventListener("load",()=>D(!0)));const y=Object.assign(document.createElement("canvas"),{width:E.width,height:E.height}).getContext("2d");if(!y)return!1;y.imageSmoothingEnabled=!1,y.drawImage(E,0,0);const C=y?.getImageData(0,0,E.width,E.height);if(C)for(let D=0;D<C.data.length;D+=4)if(C.data[D+3]<255)return!0}return!1})).apply(this,arguments)}function p(M){return M.map(O=>({name:O.name,ext:O.ext,type:P.VC.FILE,url:O.url,embedUrl:O.embedUrl,isImage:O.isImage}))}function h(M,O=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(M)&&!O.includes(M)}function A(M){return h(M,["gif","svg"])}function b(M,O,u,E=[],y=""){let C={...e.xt};const D=M.trim();C.invalidLength=0===D.length;const B=(D+y).replace(/\s{2,}/g," ");return C.alreadyUsed=O!==D&&E.includes(B),C.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(M),C.invalidCharacter=!(u===P.VC.FILE?e.Mi.test(M):e.er.test(M)),C}function S(M,O){return M.join("/")===O.join("/")}function K(M){let O=[],u=[];for(const E of M)E.type===P.VC.FILE?O.push(E):u.push(E);return{[P.VC.FILE]:O,[P.VC.FOLDER]:u}}},4887:(X,R,t)=>{"use strict";t.d(R,{q:()=>K});var _=t(5861),P=t(3705),e=t(4315),U=t.n(e),I=t(9829),s=t(9054),x=t(9862),o=t(8645),g=t(1687),f=t(9773),l=t(7621),p=t(1990),h=t(5487);class A{static findApp1Marker(O){const u=new DataView(O),E=new Set([65498,65497,65476,65474,65472,65499,65501]);for(let y=0;y<O.byteLength-2;y+=2){const C=u.getUint16(y);if(65505===C)return{offset:y,size:u.getUint16(y+2),little:18761==u.getUint16(y+8,!1)};if(E.has(C))break}}static stripAndReturnExif(O){return(0,_.Z)(function*(){const u=yield O.arrayBuffer(),E=A.findApp1Marker(u);return E?{file:new File([u.slice(0,E.offset),u.slice(E.offset+E.size+2)],O.name,{type:O.type,lastModified:O.lastModified}),exif:u.slice(E.offset,E.offset+E.size)}:{file:O}})()}static checkImageOrientation(O){const u=new DataView(O);if(1165519206!=u.getUint32(4,!1))return-1;const E=18761==u.getUint16(10,!1);let y=10;y+=u.getUint32(y+4,E);const C=u.getUint16(y,E);y+=2;for(let D=0;D<C;D++)if(274==u.getUint16(y+12*D,E))return u.getUint16(y+12*D+8,E);return-1}}var b=t(5879),S=t(9582);let K=(()=>{class M{constructor(u,E,y,C){this.http=u,this.uploadObservablesService=E,this.loadImageService=y,this.proxyService=C,this.requestSubscriptions=[],this.uploaderOptionsObject={compress:!0,openLinkModalAfterUpload:!1}}get uploaderOptions(){return{...this.uploaderOptionsObject}}set uploaderOptions(u){this.uploaderOptionsObject={...u}}compressFileIfNeeded(u,E){return(0,_.Z)(function*(){let y=["image/png","image/jpeg"],C={strict:!0,checkOrientation:!0,quality:.8,convertSize:1};E&&(y.push("image/webp"),C.width=E.width,C.height=E.height,C.resize="cover",C.strict=!1);const D=u.type.toLowerCase();return u.size<=4e6&&void 0===E||-1===y.indexOf(u.type.toLowerCase())?u:("image/png"===D&&(yield(0,s.JN)(u))&&(C.convertSize=1/0),new Promise((B,$)=>{new(U())(u,{...C,success:Q=>{const q=Q instanceof Blob?new File([Q],u.name,{type:u.type,lastModified:u.lastModified}):u;B(q)},error:$})}))})()}orientFileIfNeeded(u){var E=this;return(0,_.Z)(function*(){if(-1===["image/jpeg"].indexOf(u.type.toLowerCase()))return u;const C=yield A.stripAndReturnExif(u);if(u=C.file,C.exif){const D=A.checkImageOrientation(C.exif);if(1!==D){let B=0;switch(D){case 3:case 4:B=180;break;case 5:case 6:B=90;break;case 7:case 8:B=270}const $=yield(0,s.sT)(u),Q=yield new Promise((oe,ie)=>{const ae=new Image;ae.onload=()=>oe({originalImage:ae,originalBase64:$}),ae.onerror=ie,ae.src=$}),q=yield E.loadImageService.transformLoadedImage({original:{base64:Q.originalBase64,image:Q.originalImage,size:{width:Q.originalImage.naturalWidth,height:Q.originalImage.naturalHeight}},exifTransform:{flip:[2,4,5,7].includes(D),rotate:B/90}},new I.R);u=new File([(0,P.L)(q.transformed.base64)],u.name,{type:u.type,lastModified:Date.now()}),u=yield E.compressFileIfNeeded(u)}}return u})()}upload(u,E,y,C=!1){const D=new o.x,B=new FormData;B.append("payload",y),B.append("upload",u,u.name),C&&B.append("allowOverwrite","1");const $=this.http.request(new x.aW("POST",p.C7,B,{reportProgress:!0,responseType:"json"}));return this.requestSubscriptions.push($.subscribe({next:Q=>{if(Q.type===x.dt.UploadProgress){if(!Q.total||(E.progress=Math.round(50*Q.loaded/Q.total)+20,E.progress<70))return;(0,g.F)(1e3).pipe((0,f.R)(D.asObservable())).subscribe(()=>{if(E.progress<95){const q=Math.round(8*Math.random()+8);E.progress+q>95?E.progress=95:E.progress+=q}})}else if(Q instanceof x.Zn){if(E.progress=100,E.completed=!0,Q.body?.error||!Q.body?.success)E.error=!0,this.uploadObservablesService.pushUploadingFileError(E);else{E.file.url=Q.body.success.url,E.file.time=Date.now(),E.file.embedUrl=`${E.file.url}?t=${E.file.time}`;const q=(0,s.Tb)(E.file.url);E.file.name=q.name,E.file.filename=q.filename}D.next(),D.complete()}},error:()=>{E.error=!0,this.uploadObservablesService.pushUploadingFileError(E),D.next(),D.complete()}})),D.asObservable()}clearPendingRequests(){for(const u of this.requestSubscriptions)u.unsubscribe();this.requestSubscriptions=[]}}return M.\u0275fac=function(u){return new(u||M)(b.LFG(x.eN),b.LFG(h.r),b.LFG(S.y),b.LFG(l.y))},M.\u0275prov=b.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})()},4315:function(X){X.exports=function(){"use strict";function R(v,r){var c=Object.keys(v);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(v);r&&(d=d.filter(function(T){return Object.getOwnPropertyDescriptor(v,T).enumerable})),c.push.apply(c,d)}return c}function t(v){for(var r=1;r<arguments.length;r++){var c=null!=arguments[r]?arguments[r]:{};r%2?R(Object(c),!0).forEach(function(d){U(v,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(c)):R(Object(c)).forEach(function(d){Object.defineProperty(v,d,Object.getOwnPropertyDescriptor(c,d))})}return v}function P(v,r){for(var c=0;c<r.length;c++){var d=r[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(v,x(d.key),d)}}function U(v,r,c){return(r=x(r))in v?Object.defineProperty(v,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):v[r]=c,v}function I(){return I=Object.assign?Object.assign.bind():function(v){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(v[d]=c[d])}return v},I.apply(this,arguments)}function x(v){var r=function s(v,r){if("object"!=typeof v||null===v)return v;var c=v[Symbol.toPrimitive];if(void 0!==c){var d=c.call(v,r||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(v)}(v,"string");return"symbol"==typeof r?r:String(r)}var v,r,c,d,T,L,H,Z,o={exports:{}};v=o,typeof window>"u"||(r=window,c=r.HTMLCanvasElement&&r.HTMLCanvasElement.prototype,d=r.Blob&&function(){try{return!!new Blob}catch{return!1}}(),T=d&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),L=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,H=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,Z=(d||L)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(W){var j,k,G,te,V,a,F,n,m;if(!(j=W.match(H)))throw new Error("invalid data URI");for(k=j[2]?j[1]:"text/plain"+(j[3]||";charset=US-ASCII"),G=!!j[4],te=W.slice(j[0].length),V=G?atob(te):decodeURIComponent(te),a=new ArrayBuffer(V.length),F=new Uint8Array(a),n=0;n<V.length;n+=1)F[n]=V.charCodeAt(n);return d?new Blob([T?F:a],{type:k}):((m=new L).append(a),m.getBlob(k))},r.HTMLCanvasElement&&!c.toBlob&&(c.mozGetAsFile?c.toBlob=function(W,j,k){var G=this;setTimeout(function(){W(k&&c.toDataURL&&Z?Z(G.toDataURL(j,k)):G.mozGetAsFile("blob",j))})}:c.toDataURL&&Z&&(c.toBlob=c.msToBlob?function(W,j,k){var G=this;setTimeout(function(){W((j&&"image/png"!==j||k)&&c.toDataURL&&Z?Z(G.toDataURL(j,k)):G.msToBlob(j))})}:function(W,j,k){var G=this;setTimeout(function(){W(Z(G.toDataURL(j,k)))})})),v.exports?v.exports=Z:r.dataURLtoBlob=Z);var g=o.exports,l={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},h=typeof window<"u"&&typeof window.document<"u"?window:{},A=function(r){return r>0&&r<1/0},b=Array.prototype.slice;function S(v){return Array.from?Array.from(v):b.call(v)}var K=/^image\/.+$/;function M(v){return K.test(v)}var u=String.fromCharCode;var y=h.btoa;function C(v,r){for(var c=[],T=new Uint8Array(v);T.length>0;)c.push(u.apply(null,S(T.subarray(0,8192)))),T=T.subarray(8192);return"data:".concat(r,";base64,").concat(y(c.join("")))}function D(v){var c,r=new DataView(v);try{var d,T,L;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var H=r.byteLength,Z=2;Z+1<H;){if(255===r.getUint8(Z)&&225===r.getUint8(Z+1)){T=Z;break}Z+=1}if(T){var j=T+10;if("Exif"===function E(v,r,c){var T,d="";for(c+=r,T=r;T<c;T+=1)d+=u(v.getUint8(T));return d}(r,T+4,4)){var k=r.getUint16(j);if(((d=18761===k)||19789===k)&&42===r.getUint16(j+2,d)){var G=r.getUint32(j+4,d);G>=8&&(L=j+G)}}}if(L){var V,a,te=r.getUint16(L,d);for(a=0;a<te;a+=1)if(274===r.getUint16(V=L+12*a+2,d)){c=r.getUint16(V+=8,d),r.setUint16(V,1,d);break}}}catch{c=1}return c}var $=/\.\d*(?:0|9){12}\d*$/;function Q(v){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return $.test(v)?Math.round(v*r)/r:v}function q(v){var r=v.aspectRatio,c=v.height,d=v.width,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",L=A(d),H=A(c);if(L&&H){var Z=c*r;("contain"===T||"none"===T)&&Z>d||"cover"===T&&Z<d?c=d/r:d=c*r}else L?c=d/r:H&&(d=c*r);return{width:d,height:c}}var ae=h.ArrayBuffer,pe=h.FileReader,le=h.URL||h.webkitURL,_e=/\.\w+$/,ve=h.Compressor,Ee=function(){function v(r,c){(function _(v,r){if(!(v instanceof r))throw new TypeError("Cannot call a class as a function")})(this,v),this.file=r,this.exif=[],this.image=new Image,this.options=t(t({},l),c),this.aborted=!1,this.result=null,this.init()}return function e(v,r,c){return r&&P(v.prototype,r),c&&P(v,c),Object.defineProperty(v,"prototype",{writable:!1}),v}(v,[{key:"init",value:function(){var c=this,d=this.file,T=this.options;if(function(r){return!(typeof Blob>"u")&&(r instanceof Blob||"[object Blob]"===Object.prototype.toString.call(r))}(d)){var L=d.type;if(M(L))if(le&&pe){ae||(T.checkOrientation=!1,T.retainExif=!1);var H="image/jpeg"===L,Z=H&&T.checkOrientation,W=H&&T.retainExif;if(!le||Z||W){var j=new pe;this.reader=j,j.onload=function(k){var te=k.target.result,V={},a=1;Z&&(a=D(te))>1&&I(V,function B(v){var r=0,c=1,d=1;switch(v){case 2:c=-1;break;case 3:r=-180;break;case 4:d=-1;break;case 5:r=90,d=-1;break;case 6:r=90;break;case 7:r=90,c=-1;break;case 8:r=-90}return{rotate:r,scaleX:c,scaleY:d}}(a)),W&&(c.exif=function oe(v){for(var r=S(new Uint8Array(v)),c=r.length,d=[],T=0;T+3<c;){var L=r[T],H=r[T+1];if(255===L&&218===H)break;if(255===L&&216===H)T+=2;else{var W=T+(256*r[T+2]+r[T+3])+2,j=r.slice(T,W);d.push(j),T=W}}return d.reduce(function(k,G){return 255===G[0]&&225===G[1]?k.concat(G):k},[])}(te)),V.url=Z||W?!le||a>1?C(te,L):le.createObjectURL(d):te,c.load(V)},j.onabort=function(){c.fail(new Error("Aborted to read the image with FileReader."))},j.onerror=function(){c.fail(new Error("Failed to read the image with FileReader."))},j.onloadend=function(){c.reader=null},Z||W?j.readAsArrayBuffer(d):j.readAsDataURL(d)}else this.load({url:le.createObjectURL(d)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(c){var d=this,T=this.file,L=this.image;L.onload=function(){d.draw(t(t({},c),{},{naturalWidth:L.naturalWidth,naturalHeight:L.naturalHeight}))},L.onabort=function(){d.fail(new Error("Aborted to load the image."))},L.onerror=function(){d.fail(new Error("Failed to load the image."))},h.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(h.navigator.userAgent)&&(L.crossOrigin="anonymous"),L.alt=T.name,L.src=c.url}},{key:"draw",value:function(c){var d=this,T=c.naturalWidth,L=c.naturalHeight,H=c.rotate,Z=void 0===H?0:H,W=c.scaleX,j=void 0===W?1:W,k=c.scaleY,G=void 0===k?1:k,te=this.file,V=this.image,a=this.options,F=document.createElement("canvas"),n=F.getContext("2d"),m=Math.abs(Z)%180==90,i=("contain"===a.resize||"cover"===a.resize)&&A(a.width)&&A(a.height),w=Math.max(a.maxWidth,0)||1/0,N=Math.max(a.maxHeight,0)||1/0,J=Math.max(a.minWidth,0)||0,ne=Math.max(a.minHeight,0)||0,se=T/L,ee=a.width,Y=a.height;if(m){var ce=[N,w];w=ce[0],N=ce[1];var z=[ne,J];J=z[0],ne=z[1];var re=[Y,ee];ee=re[0],Y=re[1]}i&&(se=ee/Y);var ue=q({aspectRatio:se,width:w,height:N},"contain");w=ue.width,N=ue.height;var he=q({aspectRatio:se,width:J,height:ne},"cover");if(J=he.width,ne=he.height,i){var me=q({aspectRatio:se,width:ee,height:Y},a.resize);ee=me.width,Y=me.height}else{var Me=q({aspectRatio:se,width:ee,height:Y}),Ue=Me.width;ee=void 0===Ue?T:Ue;var be=Me.height;Y=void 0===be?L:be}var Fe=-(ee=Math.floor(Q(Math.min(Math.max(ee,J),w))))/2,Be=-(Y=Math.floor(Q(Math.min(Math.max(Y,ne),N))))/2,We=ee,je=Y,Oe=[];if(i){var Ae,ye,Te=q({aspectRatio:se,width:T,height:L},{contain:"cover",cover:"contain"}[a.resize]);Oe.push((T-(Ae=Te.width))/2,(L-(ye=Te.height))/2,Ae,ye)}if(Oe.push(Fe,Be,We,je),m){var De=[Y,ee];ee=De[0],Y=De[1]}F.width=ee,F.height=Y,M(a.mimeType)||(a.mimeType=te.type);var Ie="transparent";te.size>a.convertSize&&a.convertTypes.indexOf(a.mimeType)>=0&&(a.mimeType="image/jpeg");var Se="image/jpeg"===a.mimeType;if(Se&&(Ie="#fff"),n.fillStyle=Ie,n.fillRect(0,0,ee,Y),a.beforeDraw&&a.beforeDraw.call(this,n,F),!this.aborted&&(n.save(),n.translate(ee/2,Y/2),n.rotate(Z*Math.PI/180),n.scale(j,G),n.drawImage.apply(n,[V].concat(Oe)),n.restore(),a.drew&&a.drew.call(this,n,F),!this.aborted)){var Le=function(ge){if(!d.aborted){var we=function(fe){return d.done({naturalWidth:T,naturalHeight:L,result:fe})};if(ge&&Se&&a.retainExif&&d.exif&&d.exif.length>0){var Re=function(fe){return we(g(C(function ie(v,r){var c=S(new Uint8Array(v));if(255!==c[2]||224!==c[3])return v;var T=[255,216].concat(r,c.slice(4+(256*c[4]+c[5])));return new Uint8Array(T)}(fe,d.exif),a.mimeType)))};if(ge.arrayBuffer)ge.arrayBuffer().then(Re).catch(function(){d.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var de=new pe;d.reader=de,de.onload=function(xe){Re(xe.target.result)},de.onabort=function(){d.fail(new Error("Aborted to read the compressed image with FileReader."))},de.onerror=function(){d.fail(new Error("Failed to read the compressed image with FileReader."))},de.onloadend=function(){d.reader=null},de.readAsArrayBuffer(ge)}}else we(ge)}};F.toBlob?F.toBlob(Le,a.mimeType,a.quality):Le(g(F.toDataURL(a.mimeType,a.quality)))}}},{key:"done",value:function(c){var d=c.naturalWidth,T=c.naturalHeight,L=c.result,H=this.file,Z=this.image,W=this.options;if(le&&0===Z.src.indexOf("blob:")&&le.revokeObjectURL(Z.src),L)if(W.strict&&!W.retainExif&&L.size>H.size&&W.mimeType===H.type&&!(W.width>d||W.height>T||W.minWidth>d||W.minHeight>T||W.maxWidth<d||W.maxHeight<T))L=H;else{var j=new Date;L.lastModified=j.getTime(),L.lastModifiedDate=j,L.name=H.name,L.name&&L.type!==H.type&&(L.name=L.name.replace(_e,function O(v){var r=M(v)?v.substr(6):"";return"jpeg"===r&&(r="jpg"),".".concat(r)}(L.type)))}else L=H;this.result=L,W.success&&W.success.call(this,L)}},{key:"fail",value:function(c){var d=this.options;if(!d.error)throw c;d.error.call(this,c)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ve,v}},{key:"setDefaults",value:function(c){I(l,c)}}]),v}();return Ee}()},1687:(X,R,t)=>{"use strict";t.d(R,{F:()=>e});var _=t(6321),P=t(4825);function e(U=0,I=_.z){return U<0&&(U=0),(0,P.H)(U,U,I)}},4004:(X,R,t)=>{"use strict";t.d(R,{Z:()=>l});const P={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let e;const U=new Uint8Array(16);function I(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(U)}const s=[];for(let p=0;p<256;++p)s.push((p+256).toString(16).slice(1));const l=function f(p,h,A){if(P.randomUUID&&!h&&!p)return P.randomUUID();const b=(p=p||{}).random||(p.rng||I)();if(b[6]=15&b[6]|64,b[8]=63&b[8]|128,h){A=A||0;for(let S=0;S<16;++S)h[A+S]=b[S];return h}return function x(p,h=0){return(s[p[h+0]]+s[p[h+1]]+s[p[h+2]]+s[p[h+3]]+"-"+s[p[h+4]]+s[p[h+5]]+"-"+s[p[h+6]]+s[p[h+7]]+"-"+s[p[h+8]]+s[p[h+9]]+"-"+s[p[h+10]]+s[p[h+11]]+s[p[h+12]]+s[p[h+13]]+s[p[h+14]]+s[p[h+15]]).toLowerCase()}(b)}}}]);